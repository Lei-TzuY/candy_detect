# éŒ„å½±ç¨‹å¼è§£æåº¦å’Œå¹€ç‡èª¿æ•´åŠŸèƒ½

## ğŸ“ éœ€è¦æ·»åŠ çš„åŠŸèƒ½

åœ¨éŒ„å½±ä»‹é¢æ·»åŠ ï¼š
1. è§£æåº¦é¸æ“‡ä¸‹æ‹‰é¸å–®ï¼ˆVGAåˆ°4Kï¼‰
2. å¹€ç‡èª¿æ•´æ»‘è»Œï¼ˆ15-60 FPSï¼‰

## ğŸ”§ å¯¦æ–½æ­¥é©Ÿ

### æ­¥é©Ÿ 1ï¼šä¿®æ”¹ `templates/recorder.html`

åœ¨ç„¦è·æ§åˆ¶å€å¡Šå¾Œï¼ˆç´„402è¡Œï¼‰ï¼Œæ·»åŠ ï¼š

```html
                <!-- è§£æåº¦è¨­å®š -->
                <div class="focus-control">
                    <h3>ğŸ“ è§£æåº¦è¨­å®š</h3>
                    <div class="camera-select">
                        <select id="resolution-select" onchange="updateResolution()">
                            <option value="640x480">640 Ã— 480 (VGA)</option>
                            <option value="1280x720">1280 Ã— 720 (HD)</option>
                            <option value="1920x1080" selected>1920 Ã— 1080 (Full HD)</option>
                            <option value="2560x1440">2560 Ã— 1440 (2K)</option>
                            <option value="3840x2160">3840 Ã— 2160 (4K)</option>
                        </select>
                    </div>
                </div>
                
                <!-- å¹€ç‡è¨­å®š -->
                <div class="focus-control">
                    <h3>ğŸ¬ å¹€ç‡è¨­å®š</h3>
                    <div class="focus-slider-container">
                        <span>FPS:</span>
                        <input type="range" class="focus-slider" id="fps-slider" 
                               min="15" max="60" value="30" step="5" oninput="updateFPS()">
                        <div class="focus-value" id="fps-value">30</div>
                    </div>
                </div>
```

### æ­¥é©Ÿ 2ï¼šæ·»åŠ  JavaScript å‡½æ•¸

åœ¨ setFocus å‡½æ•¸å¾Œï¼ˆç´„637è¡Œï¼‰ï¼Œæ·»åŠ ï¼š

```javascript
        // æ›´æ–°è§£æåº¦
        async function updateResolution() {
            const select = document.getElementById('resolution-select');
            const resolution = select.value;
            const [width, height] = resolution.split('x').map(Number);
            
            try {
                await fetch(`/api/recorder/${currentCamera}/resolution`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ width, height })
                });
                console.log(`è§£æåº¦å·²æ›´æ–°: ${width}x${height}`);
                // å¦‚æœæ­£åœ¨é è¦½ï¼Œé‡æ–°å•Ÿå‹•
                if (isPreviewing) {
                    stopPreview();
                    setTimeout(() => startPreview(), 500);
                }
            } catch (e) {
                console.error('è¨­å®šè§£æåº¦å¤±æ•—:', e);
                alert('è¨­å®šè§£æåº¦å¤±æ•—: ' + e.message);
            }
        }
        
        // æ›´æ–°å¹€ç‡
        async function updateFPS() {
            const fps = parseInt(document.getElementById('fps-slider').value);
            document.getElementById('fps-value').textContent = fps;
            
            try {
                await fetch(`/api/recorder/${currentCamera}/fps`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ fps })
                });
                console.log(`å¹€ç‡å·²æ›´æ–°: ${fps} FPS`);
            } catch (e) {
                console.error('è¨­å®šå¹€ç‡å¤±æ•—:', e);
            }
        }
```

### æ­¥é©Ÿ 3ï¼šæ·»åŠ å¾Œç«¯ API åˆ° `web_app.py`

åœ¨ç¾æœ‰çš„ recorder API é™„è¿‘æ·»åŠ ï¼š

```python
@app.route('/api/recorder/<int:camera_index>/resolution', methods=['POST'])
def set_recorder_resolution(camera_index):
    """è¨­å®šéŒ„å½±è§£æåº¦"""
    try:
        data = request.json or {}
        width = data.get('width', 1920)
        height = data.get('height', 1080)
        
        recorder = recorder_instances.get(camera_index)
        if recorder and recorder.cap:
            recorder.width = width
            recorder.height = height
            recorder.cap.set(cv2.CAP_PROP_FRAME_WIDTH, width)
            recorder.cap.set(cv2.CAP_PROP_FRAME_HEIGHT, height)
            logger.info(f"éŒ„å½±æ©Ÿ {camera_index} è§£æåº¦å·²è¨­ç‚º: {width}x{height}")
            return jsonify({'success': True, 'width': width, 'height': height})
        else:
            return jsonify({'success': False, 'error': 'éŒ„å½±æ©Ÿæœªåˆå§‹åŒ–'}), 400
    except Exception as e:
        logger.error(f"è¨­å®šè§£æåº¦å¤±æ•—: {e}")
        return jsonify({'success': False, 'error': str(e)}), 500


@app.route('/api/recorder/<int:camera_index>/fps', methods=['POST'])
def set_recorder_fps(camera_index):
    """è¨­å®šéŒ„å½±å¹€ç‡"""
    try:
        data = request.json or {}
        fps = data.get('fps', 30)
        
        recorder = recorder_instances.get(camera_index)
        if recorder and recorder.cap:
            recorder.fps = fps
            recorder.cap.set(cv2.CAP_PROP_FPS, fps)
            logger.info(f"éŒ„å½±æ©Ÿ {camera_index} å¹€ç‡å·²è¨­ç‚º: {fps} FPS")
            return jsonify({'success': True, 'fps': fps})
        else:
            return jsonify({'success': False, 'error': 'éŒ„å½±æ©Ÿæœªåˆå§‹åŒ–'}), 400
    except Exception as e:
        logger.error(f"è¨­å®šå¹€ç‡å¤±æ•—: {e}")
        return jsonify({'success': False, 'error': str(e)}), 500
```

## âš ï¸ æ³¨æ„äº‹é …

1. **è§£æåº¦è¨­å®šï¼š** ä¿®æ”¹è§£æåº¦éœ€è¦é‡æ–°åˆå§‹åŒ–æ”å½±æ©Ÿï¼Œå»ºè­°åœ¨é è¦½å‰è¨­å®š
2. **å¹€ç‡é™åˆ¶ï¼š** å¯¦éš›å¹€ç‡å—æ”å½±æ©Ÿç¡¬é«”é™åˆ¶ï¼ŒæŸäº›æ”å½±æ©Ÿå¯èƒ½ä¸æ”¯æ´é«˜å¹€ç‡
3. **æ•ˆèƒ½å½±éŸ¿ï¼š** 4KéŒ„å½±æœƒæ¶ˆè€—æ›´å¤šCPUå’Œå„²å­˜ç©ºé–“

##æ¸¬è©¦æ­¥é©Ÿ

1. å•Ÿå‹•éŒ„å½±ä»‹é¢
2. é¸æ“‡è§£æåº¦ï¼ˆä¾‹å¦‚1280x720ï¼‰
3. èª¿æ•´å¹€ç‡æ»‘è»Œï¼ˆä¾‹å¦‚è¨­ç‚º24 FPSï¼‰
4. é–‹å§‹é è¦½ï¼Œç¢ºèªè§£æåº¦å’Œæµæš¢åº¦
5. é–‹å§‹éŒ„å½±ï¼Œæª¢æŸ¥éŒ„è£½çš„å½±ç‰‡åƒæ•¸

## ğŸ¯ ä¸‹ä¸€æ­¥å„ªåŒ–

- æ·»åŠ è§£æåº¦å’Œå¹€ç‡çš„å³æ™‚é¡¯ç¤º
- åœ¨ç‹€æ…‹é¢æ¿é¡¯ç¤ºç•¶å‰è§£æåº¦å’Œå¯¦éš›å¹€ç‡
- å„²å­˜ç”¨æˆ¶åå¥½è¨­å®šåˆ°æœ¬åœ°å„²å­˜
