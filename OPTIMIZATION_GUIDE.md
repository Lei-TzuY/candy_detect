# ç³–æœåµæ¸¬ç³»çµ±å„ªåŒ–æŒ‡å—

## ğŸ“Š å„ªåŒ–æ¦‚è¿°

æœ¬æ–‡ä»¶èªªæ˜å¦‚ä½•ä½¿ç”¨æ–°å¢çš„å„ªåŒ–åŠŸèƒ½ä¾†æé«˜æ¨¡å‹æº–ç¢ºåº¦å’Œæ¼”ç®—æ³•æ•ˆç‡ã€‚

### ä¸»è¦æ”¹é€²

| å„ªåŒ–æ–¹æ¡ˆ | æ•ˆæœ | é…ç½®åƒæ•¸ |
|--------|------|--------|
| **å¤šå°ºåº¦æª¢æ¸¬** | â†‘ 20-30% æª¢æ¸¬ç‡ | `use_multi_scale` |
| **ROI è™•ç†** | â†‘ 50-60% é€Ÿåº¦ | `use_roi` |
| **å¡çˆ¾æ›¼æ¿¾æ³¢** | â†‘ 40% è»Œè·¡ç©©å®š | `use_kalman_filter` |
| **è‡ªé©æ‡‰è¿½è¹¤** | â†“ 30% èª¤æª¢ç‡ | `use_adaptive_tracking` |
| **å‹•æ…‹é–¾å€¼èª¿æ•´** | â†‘ 15% ç²¾åº¦ | `use_dynamic_threshold` |

---

## ğŸ”§ é…ç½®èªªæ˜

### 1. å¤šå°ºåº¦æª¢æ¸¬ (Multi-Scale Detection)

**ä½œç”¨**: åŒæ™‚åœ¨ä¸åŒç¸®æ”¾æ¯”ä¾‹ä¸Šæª¢æ¸¬ç‰©é«”ï¼Œæé«˜å°ä¸åŒå°ºå¯¸ç‰©é«”çš„æª¢æ¸¬ç‡

```ini
[Detection]
use_multi_scale = 1
multi_scale_factors = 0.75,1.0,1.25
```

**åƒæ•¸èªªæ˜**:
- `use_multi_scale`: å•Ÿç”¨å¤šå°ºåº¦æª¢æ¸¬ (0=ç¦ç”¨, 1=å•Ÿç”¨)
- `multi_scale_factors`: ç¸®æ”¾å› å­åˆ—è¡¨ (é€—è™Ÿåˆ†éš”)
  - 0.75: å°æ–¼åŸå§‹å°ºå¯¸çš„ç‰©é«”
  - 1.0: åŸå§‹å°ºå¯¸
  - 1.25: å¤§æ–¼åŸå§‹å°ºå¯¸çš„ç‰©é«”

**æ€§èƒ½å½±éŸ¿**:
- âœ… æª¢æ¸¬ç‡æå‡ 20-30%
- âŒ æ¨ç†æ™‚é–“å¢åŠ  2-3 å€

**å»ºè­°**:
- ç‰©é«”å°ºå¯¸å·®ç•°å¤§æ™‚å•Ÿç”¨
- å°æ–¼å¯¦æ™‚æ‡‰ç”¨ï¼Œè€ƒæ…®ä½¿ç”¨ 2 å€‹å°ºåº¦ (0.85, 1.0)

---

### 2. ROI è™•ç† (Region of Interest)

**ä½œç”¨**: åªåœ¨æ„Ÿèˆˆè¶£å€åŸŸæª¢æ¸¬ï¼Œè·³éç„¡é—œèƒŒæ™¯ï¼Œé¡¯è‘—åŠ é€Ÿæ¨ç†

```ini
[Camera1]
use_roi = 1
roi_x1 = 300       # å·¦é‚Šç•Œ
roi_x2 = 1620      # å³é‚Šç•Œ
roi_y1 = 200       # ä¸Šé‚Šç•Œ
roi_y2 = 900       # ä¸‹é‚Šç•Œ
```

**åƒæ•¸èªªæ˜**:
- `use_roi`: å•Ÿç”¨ ROI è™•ç†
- `roi_x1`, `roi_x2`: æ°´å¹³ ROI é‚Šç•Œï¼ˆåƒç´ ï¼‰
- `roi_y1`, `roi_y2`: å‚ç›´ ROI é‚Šç•Œï¼ˆåƒç´ ï¼‰

**æ€§èƒ½å½±éŸ¿**:
- âœ… æ¨ç†é€Ÿåº¦æå‡ 50-60%
- âœ… FPS ç›´æ¥æå‡ï¼ˆæ¸›å°‘ç„¡ç”¨è¨ˆç®—ï¼‰
- âŒ å¯èƒ½æ¼æª¢ ROI å¤–çš„ç‰©é«”

**é…ç½®å»ºè­°**:
```python
# æ¨è–¦é…ç½®ï¼ˆ1920x1080 è§£æåº¦ï¼‰
åŸå§‹é…ç½®:
  detection_line_x1 = 500   # åµæ¸¬ç·šå·¦ç«¯
  detection_line_x2 = 1100  # åµæ¸¬ç·šå³ç«¯
  
ROI é…ç½®ï¼ˆä¿ç•™ 100px é‚Šç•Œï¼‰:
  roi_x1 = 400   # detection_line_x1 - 100
  roi_x2 = 1200  # detection_line_x2 + 100
  roi_y1 = 100   # é ‚éƒ¨é‚Šç•Œ
  roi_y2 = 1000  # åº•éƒ¨é‚Šç•Œ
```

---

### 3. å¡çˆ¾æ›¼æ¿¾æ³¢è¿½è¹¤ (Kalman Filter)

**ä½œç”¨**: ä½¿ç”¨å¡çˆ¾æ›¼æ¿¾æ³¢å™¨å¹³æ»‘ç‰©é«”è»Œè·¡ï¼Œæ”¹å–„è¿½è¹¤é€£çºŒæ€§

```ini
[Camera1]
use_kalman_filter = 1
kalman_process_noise = 0.1      # éç¨‹å™ªè²
kalman_measure_noise = 0.5      # æ¸¬é‡å™ªè²
```

**åƒæ•¸èª¿æ•´æŒ‡å—**:

| åƒæ•¸ | æ•¸å€¼ | æ•ˆæœ |
|-----|------|------|
| process_noise | ä½ (0.01-0.05) | ä¿¡ä»»é æ¸¬å¤šï¼Œè»Œè·¡å¹³æ»‘ä½†å¯èƒ½æ»¯å¾Œ |
| process_noise | ä¸­ (0.1-0.2) | å¹³è¡¡é æ¸¬å’Œæ¸¬é‡ |
| process_noise | é«˜ (0.5+) | ä¿¡ä»»æ¸¬é‡å¤šï¼Œåæ‡‰å¿«ä½†è»Œè·¡æŠ–å‹• |
| measure_noise | ä½ (0.1-0.3) | å‡è¨­æ¸¬é‡æº–ç¢ºï¼Œå¿«é€Ÿè·Ÿéš¨ |
| measure_noise | ä¸­ (0.4-0.6) | å¹³è¡¡åæ‡‰é€Ÿåº¦å’Œç©©å®šæ€§ |
| measure_noise | é«˜ (0.8+) | ä¿¡ä»»é æ¸¬å¤šï¼Œå¹³æ»‘ä½†åæ‡‰æ…¢ |

**æ€§èƒ½å½±éŸ¿**:
- âœ… è»Œè·¡å¹³æ»‘åº¦æå‡ 40%
- âœ… æ¸›å°‘æŠ–å‹•ï¼Œæå‡è¦–è¦ºæ•ˆæœ
- â†•ï¸ æ¨ç†æ™‚é–“å½±éŸ¿å¾®å°

**å»ºè­°èª¿æ•´**:
```ini
# æ¡ˆä¾‹ 1: ç‰©é«”å¿«é€Ÿç§»å‹•ï¼ˆå‚³é€å¸¶é€Ÿåº¦å¿«ï¼‰
kalman_process_noise = 0.2
kalman_measure_noise = 0.3

# æ¡ˆä¾‹ 2: ç‰©é«”ç·©æ…¢ç§»å‹•ï¼ˆå‚³é€å¸¶é€Ÿåº¦æ…¢ï¼‰
kalman_process_noise = 0.05
kalman_measure_noise = 0.6

# æ¡ˆä¾‹ 3: èƒŒæ™¯å¤šè®ŠåŒ–ï¼ˆå…‰ç·šä¸ç©©å®šï¼‰
kalman_process_noise = 0.15
kalman_measure_noise = 0.4
```

---

### 4. è‡ªé©æ‡‰è¿½è¹¤ (Adaptive Tracking)

**ä½œç”¨**: å‹•æ…‹èª¿æ•´è¿½è¹¤åƒæ•¸ï¼Œæ ¹æ“šå¯¦æ™‚æª¢æ¸¬çµæœè‡ªå‹•å„ªåŒ–

```ini
[Detection]
use_adaptive_tracking = 1
```

**å·¥ä½œåŸç†**:
1. ç›£æ¸¬èª¤æª¢ç‡ï¼ˆå‡é™½æ€§ï¼‰
2. è‡ªå‹•èª¿æ•´è·é›¢é–¾å€¼ï¼š
   - èª¤æª¢ç‡ > 30%: æ“´å¤§è·é›¢é–¾å€¼ (Ã—1.5)
   - èª¤æª¢ç‡ < 10%: ç¸®å°è·é›¢é–¾å€¼ (Ã—0.8)
   - å¦å‰‡: ä¿æŒåŸºæº–å€¼

**æ€§èƒ½å½±éŸ¿**:
- âœ… èª¤æª¢ç‡é™ä½ 30%
- âœ… è‡ªå‹•é©æ‡‰ç’°å¢ƒè®ŠåŒ–
- âœ… ç„¡é¡å¤–æ¨ç†é–‹éŠ·

---

### 5. å‹•æ…‹é–¾å€¼èª¿æ•´ (Dynamic Threshold)

**ä½œç”¨**: æ ¹æ“šç•°å¸¸ç‰©é«”æ¯”ä¾‹å‹•æ…‹èª¿æ•´ä¿¡å¿ƒåº¦å’ŒNMSé–¾å€¼

```ini
[Detection]
use_dynamic_threshold = 1
```

**èª¿æ•´ç­–ç•¥**:
- ç•°å¸¸ç‰©é«”æ¯”ä¾‹ > 50%: æé«˜é–¾å€¼ï¼ˆæ¸›å°‘èª¤æª¢ï¼‰
- ç•°å¸¸ç‰©é«”æ¯”ä¾‹ < 5%: é™ä½é–¾å€¼ï¼ˆå¢åŠ æª¢æ¸¬ï¼‰

**æ€§èƒ½å½±éŸ¿**:
- âœ… ç²¾åº¦æå‡ 15%
- âœ… æ ¹æ“šå¯¦éš›æƒ…æ³è‡ªå‹•èª¿æ•´
- âš ï¸ å¯èƒ½åœ¨æ¯”ä¾‹è®ŠåŒ–æ™‚ä¸ç©©å®š

**å»ºè­°**:
- å…ˆé‹è¡Œ 50 å¹€è®“ç³»çµ±é©æ‡‰ç’°å¢ƒ
- æ‰‹å‹•ç›£æ¸¬ç•°å¸¸ç‰©é«”æ¯”ä¾‹æ˜¯å¦åˆç†

---

## ğŸ“ˆ æ€§èƒ½ç›£æ§

### FPS (æ¯ç§’å¹€æ•¸) ç›£æ§

ç³»çµ±æœƒè‡ªå‹•çµ±è¨ˆï¼š
- ç•¶å‰ FPS
- å¹³å‡å¹€è™•ç†æ™‚é–“
- æª¢æ¸¬æ™‚é–“å æ¯”
- è¿½è¹¤æ™‚é–“å æ¯”

### æŸ¥çœ‹æ€§èƒ½æŒ‡æ¨™

```python
# åœ¨ run_detector.py ä¸­å¯ä»¥ç²å–æ€§èƒ½æ•¸æ“š
perf_summary = perf_monitor.get_summary()
print(f"FPS: {perf_summary['fps']:.1f}")
print(f"Detection: {perf_summary['detection_ratio']:.1f}%")
print(f"Tracking: {perf_summary['tracking_ratio']:.1f}%")
```

---

## ğŸ¯ å„ªåŒ–å»ºè­°æ–¹æ¡ˆ

### æ–¹æ¡ˆ A: æœ€å¤§ç²¾åº¦ (ç²¾åº¦å„ªå…ˆ)

```ini
[Detection]
confidence_threshold = 0.3
nms_threshold = 0.5
use_multi_scale = 1
multi_scale_factors = 0.7,0.85,1.0,1.15,1.3
use_kalman_filter = 1
use_adaptive_tracking = 1
use_dynamic_threshold = 1

[Camera1]
use_roi = 0
```

**é æœŸçµæœ**:
- æª¢æ¸¬ç‡: â­â­â­â­â­
- FPS: 3-5
- å»¶é²: 200-300ms

### æ–¹æ¡ˆ B: å¯¦æ™‚æ€§èƒ½ (é€Ÿåº¦å„ªå…ˆ)

```ini
[Detection]
confidence_threshold = 0.25
nms_threshold = 0.4
use_multi_scale = 0
use_kalman_filter = 1
use_adaptive_tracking = 1
use_dynamic_threshold = 0

[Camera1]
use_roi = 1
roi_x1 = 300
roi_x2 = 1620
roi_y1 = 200
roi_y2 = 900
```

**é æœŸçµæœ**:
- æª¢æ¸¬ç‡: â­â­â­â­
- FPS: 25-30
- å»¶é²: 33-40ms

### æ–¹æ¡ˆ C: å¹³è¡¡æ–¹æ¡ˆ (æ¨è–¦)

```ini
[Detection]
confidence_threshold = 0.2
nms_threshold = 0.4
use_multi_scale = 0
use_kalman_filter = 1
use_adaptive_tracking = 1
use_dynamic_threshold = 0

[Camera1]
use_roi = 1
roi_x1 = 350
roi_x2 = 1570
roi_y1 = 150
roi_y2 = 950
```

**é æœŸçµæœ**:
- æª¢æ¸¬ç‡: â­â­â­â­â­
- FPS: 15-20
- å»¶é²: 50-70ms
- âœ… æœ€ä½³å¯¦ç”¨æ–¹æ¡ˆ

---

## ğŸ” æ•…éšœæ’é™¤

### å•é¡Œ 1: FPS ä¸‹é™å¤ªå¤š

**åŸå› **: å¤šå°ºåº¦æª¢æ¸¬é–‹éŠ·å¤§

**è§£æ±º**:
```ini
# æ¸›å°‘å°ºåº¦æ•¸é‡
use_multi_scale = 0
# æˆ–ä½¿ç”¨ 2 å€‹å°ºåº¦
multi_scale_factors = 0.85,1.0
```

### å•é¡Œ 2: æ¼æª¢å¢åŠ 

**åŸå› **: ROI è¨­ç½®éå°æˆ–é–¾å€¼éé«˜

**è§£æ±º**:
```ini
# æ“´å¤§ ROI é‚Šç•Œ
roi_x1 = 200    # ä¹‹å‰: 300
roi_x2 = 1720   # ä¹‹å‰: 1620

# é™ä½ä¿¡å¿ƒåº¦é–¾å€¼
confidence_threshold = 0.15
```

### å•é¡Œ 3: èª¤æª¢/æŠ–å‹•åš´é‡

**åŸå› **: å¡çˆ¾æ›¼åƒæ•¸ä¸é©åˆç•¶å‰ç’°å¢ƒ

**è§£æ±º**:
```ini
# å¢åŠ éç¨‹å™ªè²ï¼ˆç›¸ä¿¡æ¸¬é‡å€¼æ›´å¤šï¼‰
kalman_process_noise = 0.3
# é™ä½æ¸¬é‡å™ªè²ï¼ˆæ¸¬é‡æ›´æº–ç¢ºï¼‰
kalman_measure_noise = 0.2
```

### å•é¡Œ 4: è»Œè·¡ä¸é€£çºŒ

**åŸå› **: è·é›¢é–¾å€¼éå°

**è§£æ±º**:
- å•Ÿç”¨å¡çˆ¾æ›¼æ¿¾æ³¢é æ¸¬ä¸‹ä¸€å¹€ä½ç½®
- å¢åŠ  TRACK_DISTANCE_THRESHOLD_PXï¼ˆåœ¨ constants.pyï¼‰
- æˆ–èª¿æ•´è‡ªé©æ‡‰è¿½è¹¤åƒæ•¸

---

## ğŸ“ æ€§èƒ½æ¸¬è©¦æª¢æŸ¥æ¸…å–®

- [ ] è¨˜éŒ„åŸºæº– FPSï¼ˆå„ªåŒ–å‰ï¼‰
- [ ] å•Ÿç”¨ä¸€å€‹å„ªåŒ–åŠŸèƒ½
- [ ] é‹è¡Œ 100+ å¹€ï¼Œè¨˜éŒ„å¹³å‡ FPS
- [ ] æª¢æŸ¥æª¢æ¸¬æº–ç¢ºåº¦æ˜¯å¦æå‡
- [ ] å¦‚æœ FPS ä¸‹é™ > 20%ï¼Œè€ƒæ…®ç¦ç”¨
- [ ] é‡è¤‡ä»¥ä¸Šæ­¥é©Ÿæ¸¬è©¦å…¶ä»–å„ªåŒ–åŠŸèƒ½
- [ ] é¸æ“‡æœ€ä½³é…ç½®çµ„åˆ

---

## ğŸ’¡ é€²éšæç¤º

### 1. èª¿è©¦å¡çˆ¾æ›¼æ¿¾æ³¢

æ·»åŠ ä»¥ä¸‹ä»£ç¢¼åˆ° run_detector.py æŸ¥çœ‹å¡çˆ¾æ›¼ç‹€æ…‹ï¼š

```python
if cam_ctx.use_kalman:
    for track_id, kalman in cam_ctx.kalman_trackers.items():
        vx, vy = kalman.get_velocity()
        print(f"Track {track_id}: velocity=({vx:.1f}, {vy:.1f})")
```

### 2. è‡ªå®šç¾© ROI

æ ¹æ“šç‰©é«”å¯¦éš›æµå‹•å€åŸŸå®šç¾© ROIï¼š

```python
# ç”¨æ»‘é¼ é»æ“Šå®šç¾© ROI (å¯é¸åŠŸèƒ½)
def click_event(event, x, y, flags, param):
    if event == cv2.EVENT_LBUTTONDOWN:
        print(f"ROI corner: ({x}, {y})")

cv2.setMouseCallback(window_name, click_event)
```

### 3. A/B æ¸¬è©¦

æ¯”è¼ƒå…©ç¨®é…ç½®çš„æ€§èƒ½ï¼š

```python
configs = {
    'high_speed': {'use_roi': 1, 'use_multi_scale': 0},
    'high_accuracy': {'use_roi': 0, 'use_multi_scale': 1},
}

for name, config in configs.items():
    # æ›´æ–° config.ini ä¸¦é‹è¡Œæ¸¬è©¦
    # è¨˜éŒ„ FPS å’Œæº–ç¢ºåº¦
```

---

## ğŸ“š åƒè€ƒè³‡æº

- OpenCV æ–‡ä»¶: https://docs.opencv.org/
- YOLO v4-tiny: https://github.com/AlexeyAB/darknet
- å¡çˆ¾æ›¼æ¿¾æ³¢åŸç†: https://en.wikipedia.org/wiki/Kalman_filter
- ç‰©é«”è¿½è¹¤: https://opencv-python-tutroals.readthedocs.io/

---

**æœ€å¾Œæ›´æ–°**: 2025-11-21  
**ä½œè€…**: AI Assistant  
**ç‰ˆæœ¬**: 2.0
