# 🚀 啟動腳本使用指南

本專案提供多個 `.bat` 啟動腳本，以下是各個腳本的用途和使用方法。

---

## 📋 腳本總覽

| 腳本名稱 | 用途 | 推薦度 | 說明 |
|---------|------|--------|------|
| `run_all.bat` | 完整系統啟動 | ⭐⭐⭐⭐⭐ | 啟動繼電器服務 + 雙攝影機偵測 |
| `run_web.bat` | Web 介面（簡易） | ⭐⭐⭐⭐ | 最簡單的 Web 啟動方式 |
| `start_web_app.bat` | Web 介面（完整） | ⭐⭐⭐ | 使用虛擬環境，功能完整 |
| `start_web.bat` | Web 介面（中階） | ⭐⭐⭐ | 虛擬環境版本 |
| `app/run.bat` | 僅繼電器服務 | ⭐⭐ | 單獨啟動繼電器網關 |

---

## 1️⃣ run_all.bat - 完整系統啟動 ⭐⭐⭐⭐⭐

### 用途
啟動完整的瑕疵偵測系統，包含：
- Modbus 繼電器網關服務（端口 8080）
- Camera1 和 Camera2 雙攝影機偵測
- 在單一 OpenCV 視窗顯示雙攝影機畫面

### 使用方法
```bash
# 方法 1：雙擊執行
run_all.bat

# 方法 2：命令行
run_all.bat
```

### 運行流程
1. 啟動繼電器服務（app/run.bat）
2. 等待端口 8080 就緒（最多 12 秒）
3. 啟動雙攝影機偵測系統
4. 按 `Q` 鍵退出

### 適用場景
✅ 生產環境運行  
✅ 需要繼電器控制  
✅ 同時使用兩個攝影機

---

## 2️⃣ run_web.bat - Web 介面（簡易版）⭐⭐⭐⭐

### 用途
最簡單的 Web 介面啟動方式，適合快速測試。

### 使用方法
```bash
# 雙擊執行或命令行
run_web.bat
```

### 特點
- ✅ 不需要虛擬環境
- ✅ 使用系統 Python
- ✅ 自動適配路徑
- ✅ 快速啟動

### 訪問方式
啟動後訪問：`http://localhost:5000`

### 適用場景
✅ 快速測試  
✅ 開發環境  
✅ 不想設置虛擬環境

---

## 3️⃣ start_web_app.bat - Web 介面（完整版）⭐⭐⭐

### 用途
功能最完整的 Web 啟動腳本，使用虛擬環境。

### 使用方法
```bash
# 首次使用需建立虛擬環境
python -m venv .venv
.venv\Scripts\pip install -r requirements.txt

# 啟動應用
start_web_app.bat
```

### 特點
- ✅ 使用獨立虛擬環境
- ✅ 詳細的狀態訊息
- ✅ 完整的錯誤處理
- ✅ **已修正**：自動路徑偵測（無硬編碼）

### 更新內容（2025-12-01）
- 🔧 移除硬編碼路徑 `C:\Users\st313\Desktop\candy`
- 🔧 使用 `%~dp0` 自動獲取腳本路徑
- 🔧 中文化錯誤訊息
- 🔧 提供更友善的提示訊息

### 適用場景
✅ 生產環境  
✅ 需要依賴隔離  
✅ 多個 Python 專案同時開發

---

## 4️⃣ start_web.bat - Web 介面（中階版）⭐⭐⭐

### 用途
虛擬環境版本的 Web 啟動，功能比 start_web_app.bat 簡化。

### 使用方法
```bash
start_web.bat
```

### 特點
- ✅ 使用虛擬環境
- ✅ **已修正**：自動路徑偵測
- ✅ 中文化介面

### 更新內容（2025-12-01）
- 🔧 移除硬編碼路徑
- 🔧 改用自動路徑偵測
- 🔧 優化錯誤提示

### 適用場景
✅ 與 start_web_app.bat 類似  
✅ 偏好簡潔的腳本

---

## 5️⃣ app/run.bat - 僅繼電器服務 ⭐⭐

### 用途
單獨啟動 Modbus 繼電器網關服務。

### 使用方法
```bash
cd app
run.bat
```

### 功能
- 啟動 Java Modbus Gateway
- 監聽端口 8080
- 提供繼電器控制 API

### 適用場景
✅ 測試繼電器功能  
✅ 獨立運行繼電器服務  
✅ 被 run_all.bat 自動調用

---

## 🎯 使用建議

### 新手入門
```bash
# 第一次使用，推薦：
run_web.bat
```

### 生產環境
```bash
# 完整系統：
run_all.bat

# 或使用 Web 介面：
start_web_app.bat
```

### 開發測試
```bash
# 快速測試：
run_web.bat

# 調試攝影機：
python sample_recorder.py
```

---

## ⚙️ 常見問題

### Q1: 腳本無法執行？
**A:** 確保已安裝依賴：
```bash
pip install -r requirements.txt
```

### Q2: 虛擬環境找不到？
**A:** 兩種解決方法：
1. 使用 `run_web.bat`（不需虛擬環境）
2. 建立虛擬環境：
```bash
python -m venv .venv
.venv\Scripts\pip install -r requirements.txt
```

### Q3: 端口 8080 被占用？
**A:** 修改繼電器服務的端口配置，或關閉占用端口的程式。

### Q4: 繼電器服務啟動失敗？
**A:** 檢查：
- Java 17 是否已安裝（app/jdk-17.0.6）
- modbus-gateway.jar 是否存在

---

## 📊 腳本對比

| 功能 | run_all.bat | run_web.bat | start_web_app.bat |
|-----|-------------|-------------|-------------------|
| 繼電器服務 | ✅ | ❌ | ❌ |
| 攝影機偵測 | ✅ | ❌ | ❌ |
| Web 介面 | ❌ | ✅ | ✅ |
| 虛擬環境 | ❌ | ❌ | ✅ |
| 路徑自動偵測 | ✅ | ✅ | ✅ (已修正) |
| 錯誤處理 | ✅✅ | ✅ | ✅✅ |

---

## 📝 更新日誌

### 2025-12-01
- ✅ 修正 `start_web.bat` 硬編碼路徑問題
- ✅ 修正 `start_web_app.bat` 硬編碼路徑問題
- ✅ 所有腳本現在支援任意路徑運行
- ✅ 中文化錯誤訊息和提示

### 之前版本
- 部分腳本使用硬編碼路徑 `C:\Users\st313\Desktop\candy`
- 僅能在特定路徑下運行

---

**最後更新**：2025-12-01  
**維護狀態**：✅ 積極維護中
