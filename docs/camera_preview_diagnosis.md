# 攝影機預覽問題診斷報告

## 問題描述
錄影頁面的兩個鏡頭顯示黑屏，無法顯示預覽畫面。

## 診斷結果

### ✓ 攝影機硬體正常
- 測試結果：找到 4 個可用的攝影機（索引 0, 1, 2, 3）
- 所有攝影機都能正常開啟並讀取畫面
- 解析度：640x480

### ❌ 問題原因：攝影機資源衝突

**主要問題：**
1. **主偵測系統已佔用攝影機** - Camera 1 和 Camera 2 在主系統啟動時已經開啟
2. **共享攝影機機制未正常工作** - 錄影預覽嘗試獨立開啟攝影機但失敗（被佔用）
3. **預覽 API 請求超時** - 因為無法取得攝影機而卡住

## 解決方案

### 方案 1：重新啟動 Web 應用程式（推薦）

我已經在代碼中加入了詳細的診斷日誌。請執行以下步驟：

1. **停止當前的 Web 應用程式**
   - 按 Ctrl+C 停止正在運行的 Python 程序
   - 或在終端執行：
     ```powershell
     Get-Process python | Where-Object { $_.CPU -gt 100 } | Stop-Process
     ```

2. **重新啟動 Web 應用程式**
   ```powershell
   cd d:\專案\candy\src
   D:/專案/candy/.venv/Scripts/python.exe web_app.py
   ```

3. **查看日誌輸出**
   - 當您點擊「開始預覽」時，日誌會顯示詳細的診斷信息
   - 這將幫助我們找出確切的問題

### 方案 2：使用獨立錄影模式

如果共享攝影機模式有問題，可以：

1. **先停止主偵測系統**（讓攝影機資源釋放）
2. **只啟動錄影功能**

### 方案 3：檢查攝影機索引配置

確認 `config.ini` 中的攝影機索引設定：
- Camera1 使用索引 0
- Camera2 使用索引 1

如果您有 4 個攝影機，可能需要調整索引。

## 後續步驟

請您：

1. **重新啟動 Web 應用程式**
2. **開啟瀏覽器訪問錄影頁面** (http://localhost:5000/recorder)
3. **點擊「開始預覽」按鈕**
4. **查看終端的日誌輸出**並告訴我顯示了什麼

這些日誌會告訴我們：
- 是否成功取得錄影器
- shared_cap 是否正確設置
- camera_contexts 的狀態
- 預覽串流是否正常啟動

## 檔案更新

我已更新以下檔案加入診斷日誌：
- `src/web_app.py` - 在 recorder_preview 路由加入詳細日誌
- `src/video_recorder.py` - 在 generate_preview_stream 加入詳細日誌
