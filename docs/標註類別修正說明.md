# 標註類別修正說明

## 問題描述
所有自動標註的糖果都被標記為 class 1（瑕疵/abnormal），但實際上這些糖果都是正常的產品。

## 原因分析
模型在偵測時輸出的類別 ID 為 1，可能的原因：
1. 模型訓練時的標籤順序與當前 classes.txt 不一致
2. 或訓練數據標註時類別標錯了

## 解決方案

### 1. 批量修正現有標註（已完成）
使用 `fix_labels_class.py` 腳本將所有現有標註文件中的 class 1 修正為 class 0。

執行結果：
- 共找到 556 個標註文件
- 成功修正 540 個文件
- 16 個文件未修改（可能原本就是正確的）

### 2. 修正自動標註程式碼（已完成）
修改 `auto_label.py` 中的標註邏輯：
- 在寫入標註文件時，將模型輸出的 class 1 自動轉換為 class 0
- 更新視覺化顯示，使用修正後的類別

關鍵修改：
```python
# 反轉類別：模型輸出 1 (abnormal) 實際是 0 (normal)
corrected_class_id = 0 if class_id == 1 else class_id
```

## 影響範圍
- ✅ 所有現有標註文件已修正
- ✅ 未來的自動標註會自動使用正確的類別
- ✅ 視覺化顯示會正確顯示為"正常"（綠色框）

## 驗證
修正後的標註文件第一列數字都是 `0`，表示"正常"類別。

## 注意事項
如果未來重新訓練模型，建議：
1. 檢查訓練數據的類別標籤是否正確
2. 確保 classes.txt 的順序與訓練時一致
3. 如果修正了模型，記得移除 auto_label.py 中的類別反轉邏輯
