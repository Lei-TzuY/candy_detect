# 噴氣力度/持續時間控制功能

## ✅ 問題解決

### 原始問題
- **現象：** 聽到氣閥聲音但沒有氣，或噴氣很弱。
- **原因：** 電磁閥開啟時間可能太短，導致閥芯未完全開啟即關閉。

### 解決方案
新增「噴氣持續時間」(Relay Duration) 控制功能，允許調整電磁閥開啟的時間長度。

## 🔄 新增功能

### 1. 前端介面
在每個攝影機的控制卡片中，新增了一個滑桿：
- **標籤：** 💪噴氣時間(ms)
- **範圍：** 10ms - 500ms
- **預設值：** 50ms

### 2. 工作原理
當觸發噴氣時，系統現在會執行以下步驟：
1. **開啟**：發送開啟訊號 (`value=1`)
2. **保持**：等待設定的持續時間 (例如 50ms)
3. **關閉**：發送關閉訊號 (`value=0`)

這確保了氣閥有足夠的時間完全打開，釋放足夠的高壓氣體，然後準確關閉。

### 3. 設定持久化
調整滑桿後，數值會自動保存到 `config.ini` 中，重啟後依然有效。

## ⚙️ 如何使用

1. **重啟系統**：請執行 `start_all.bat` 以應用新的代碼。
2. **打開網頁**：重新整理瀏覽器頁面。
3. **調整設定**：
   - 找到新增的「💪噴氣時間」滑桿。
   - 預設是 50ms。
   - 如果噴氣太弱，試著增加到 **80ms** 或 **100ms**。
   - 如果噴氣太強或浪費氣，試著減少到 **30ms**。
4. **測試**：點擊「💨 測試噴氣」按鈕，感受氣流的變化。

## 🔧 技術變更

### 修改的文件
- `config.ini`: 新增 `relay_duration_ms` 設定。
- `src/run_detector.py`: 
  - `trigger_relay`: 實現開-延遲-關邏輯。
  - `process_camera_frame`: 傳遞持續時間參數。
- `candy_detector/models.py`: 更新 `CameraContext` 結構。
- `src/web_app.py`: 新增 API `/api/cameras/<id>/duration`。
- `static/script.js`: 新增前端滑桿和更新函數。

### 設定檔範例
```ini
[Camera1]
relay_delay_ms = 2300    ; 噴氣延遲（多久後噴）
relay_duration_ms = 50   ; 噴氣時間（噴多久）
```

現在您可以精確控制噴氣的「時機」和「力度」了！🎯
