# 糖果瑕疵偵測系統 - Web 介面使用說明

## 🎉 新功能介紹

我已經為你的專案建立了一個完整的 Web 介面，提供以下功能：

### ✨ 主要功能

1. **即時影像串流**
   - 在瀏覽器中查看所有攝影機的即時畫面
   - 無需 OpenCV 視窗，更加方便易用
   - 支援多設備同時觀看

2. **即時數據儀表板**
   - 即時統計資訊（總數、正常品、瑕疵品、瑕疵率）
   - 瑕疵率趨勢圖表
   - 產品分布圓餅圖
   - 每 2 秒自動更新數據

3. **歷史記錄查詢**
   - 查詢過去 1 小時 / 6 小時 / 24 小時 / 7 天的記錄
   - 可按攝影機篩選
   - 匯出 CSV 報表功能

4. **Web 設定管理介面**
   - 即時調整偵測參數（信心度、NMS 閾值）
   - 修改攝影機設定（偵測線位置、繼電器延遲等）
   - 無需手動編輯 config.ini

5. **SQLite 資料庫記錄**
   - 自動儲存所有偵測記錄
   - 每 10 秒記錄一次數據
   - 支援歷史數據分析

## 📦 安裝步驟

### 1. 安裝新的套件

```bash
pip install flask flask-cors
```

或直接更新所有套件：

```bash
pip install -r requirements.txt
```

## 🚀 啟動方式

### 方法一：使用批次檔（推薦）

直接雙擊 `run_web.bat` 即可啟動 Web 介面。

### 方法二：使用命令列

```bash
python web_app.py
```

## 🌐 使用方式

1. 啟動後，開啟瀏覽器
2. 前往 `http://localhost:5000`
3. 你會看到三個分頁：
   - **儀表板**：即時監控畫面和統計資訊
   - **歷史記錄**：查詢和匯出歷史數據
   - **系統設定**：調整偵測和攝影機參數

## 📱 多設備訪問

如果想在同一區域網路的其他設備上訪問（例如手機、平板），請使用：

```
http://[你的電腦IP]:5000
```

查詢電腦 IP 的方法：
```bash
ipconfig
```
找到 `IPv4 位址` 即可。

## 📊 資料庫說明

系統會自動建立 `detection_data.db` SQLite 資料庫，包含：

- **detections** 表：儲存偵測記錄（時間、攝影機、統計數據）
- **defect_images** 表：儲存瑕疵品圖片（預留功能）

## 🎨 介面特色

- 🎨 漂亮的漸層背景和卡片式設計
- 📊 即時更新的圖表（使用 Chart.js）
- 📱 響應式設計，支援手機和平板
- 🚀 快速載入，流暢的使用者體驗
- 🌏 完整中文介面

## ⚙️ 設定說明

### 偵測參數
- **信心度閾值**：YOLO 模型的偵測信心度門檻（預設 0.2）
- **NMS 閾值**：非極大值抑制門檻（預設 0.4）

### 攝影機設定
- **攝影機索引**：攝影機的裝置編號
- **繼電器延遲**：偵測到瑕疵後延遲多久觸發繼電器（毫秒）
- **偵測線 X1/X2**：物體通過此區域才計數

## 🔧 進階功能（未來擴充）

目前已經建立好架構，未來可以輕鬆加入：
- ✉️ Email/Telegram 警報通知
- 📸 瑕疵品自動截圖儲存
- 👥 使用者登入和權限管理
- 🌍 多語言支援（中英文切換）
- 📈 更多統計圖表和分析功能
- 🔔 即時警報系統

## 📝 檔案結構

```
candy/
├── web_app.py              # Flask 後端主程式
├── run_web.bat             # Web 介面啟動批次檔
├── templates/
│   └── index.html          # 前端 HTML 模板
├── static/
│   ├── style.css           # 樣式表
│   └── script.js           # JavaScript 功能
├── detection_data.db       # SQLite 資料庫（自動產生）
└── requirements.txt        # 套件清單（已更新）
```

## 🐛 疑難排解

### 問題：無法載入攝影機畫面
- 確認 `config.ini` 中的攝影機設定正確
- 確認攝影機已連接且沒有被其他程式佔用

### 問題：無法啟動 Web 伺服器
- 確認已安裝 Flask：`pip install flask flask-cors`
- 確認 Port 5000 沒有被佔用

### 問題：圖表無法顯示
- 檢查瀏覽器的開發者工具（F12）查看錯誤訊息
- 確認網路連線正常（Chart.js 從 CDN 載入）

## 💡 使用建議

1. 建議使用 Chrome 或 Edge 瀏覽器以獲得最佳體驗
2. 可以在多個瀏覽器分頁開啟不同的視圖
3. 定期匯出歷史記錄備份數據
4. 修改設定後需重新啟動系統才會生效

## 🎯 與原有系統的比較

| 功能 | 原有系統 (OpenCV) | 新 Web 介面 |
|------|------------------|------------|
| 影像顯示 | OpenCV 視窗 | 瀏覽器即時串流 |
| 多設備查看 | ❌ | ✅ |
| 歷史記錄 | ❌ | ✅ |
| 統計圖表 | ❌ | ✅ |
| 資料匯出 | ❌ | ✅ (CSV) |
| 設定調整 | 手動編輯 config.ini | Web 介面 |
| 美觀度 | 基本 | 專業美觀 |

## 📞 技術支援

如有任何問題或建議，歡迎提出！

---

**享受全新的 Web 介面吧！** 🎊
